<div class="main-content">
    <div class="breadcrumbs" id="breadcrumbs">
    	<script src="${www}/js/layer/layer.js"></script>
        <script type="text/javascript">
        var totalSort="";
        function sort(id){
        	var width=$(window).width();
        	var height=$(window).height();
        	var html="<div align=\"center\">";
        	html+="<form id=\"form_updSort\" action=\"${www}/subject/updAutoOpenPriority\" method=\"post\" class=\"form-horizontal\">";
        	html+="<input type=\"hidden\" name=\"id\" value=\""+id+"\" />";
        	html+="<table style=\"width:80%;\">";
        	html+="<tr><td colspan=\"2\" align=\"center\" style=\"height:90px;\"><h2>提示</h2></td></tr>";
        	html+="<tr><td align=\"right\">请设置指定顺序：</td><td align=\"left\">";
        	html+="<input type=\"text\" id=\"iAutoOpenPriority\" name=\"iAutoOpenPriority\" size=\"40\" onkeyup=\"if(this.value.length>1){this.value=this.value.substring(0,1)}if(this.value.length>=1){this.value=this.value.replace(/[^0-3]/g,'')}else{this.value=this.value.replace(/\D/g,'')}\" onafterpaste=\"if(this.value.length>1){this.value=this.value.substring(0,1)}if(this.value.length>=1){this.value=this.value.replace(/[^0-3]/g,'')}else{this.value=this.value.replace(/\D/g,'')}\"/></td></tr>";
        	html+="<tr><td colspan=\"2\" style=\"height:90px;\">提示：最多可对三个待开标标的设置置顶操作，从1开始，数字越大（最大值为3），优先级越高，如果不做排序，请将排序顺序设置为0</td></tr>";
        	html+="<tr><td colspan=\"2\" align=\"center\"><button class=\"btn btn-info\" type=\"button\" onclick=\"updSort()\"><i class=\"icon-ok bigger-110\"></i>确定</td></tr>";
        	html+="</table>";
        	html+="</form>";
        	html+="</div>";
        	layer.open({
                type: 1,
                title: false,
                fix: false,
                shadeClose: true,
                maxmin: false,
                area: [''+width/2+'px', ''+height/2+'px'],
                content: html
            });
        }
		
		function xiajia(id){
        	if(confirm("您正在对该标的进行下架处理，下架后请重新对标的上线时间进行设置及审核。确认下架？")){
				jQuery.ajax({
			        url: '$!{www}' + '/subject/downSubject',
			        type: 'post',
			        dataType: 'json',
			        data: {
						id : id,  
					},
			        success:xiajiaBack
			    });
			}
        }
		
		function xiajiaBack(data){
			alert(data.msg);
			if(data.success){
				location.reload();
			}
			
		}
        
        function updSort(){
        	var s_val=$("#iAutoOpenPriority").val();
        	if(s_val==""){
        		alert("请输入排序数!");
        		$("#iAutoOpenPriority").focus();
        		return;
        	}
        	var sortArra=totalSort.substring(0,totalSort.length-1).split(",");
        	for(var i=0;i<sortArra.length;i++){
        		if(s_val==sortArra[i]){
            		alert("您输入的排序数值["+s_val+"]已经存在!");
            		return;
            	}
        	}
        	$("#form_updSort").submit();
        }
        </script>

        <ul class="breadcrumb">
            <li>
                <i class="icon-home home-icon"></i>
                <a href="${www}/main">主页</a>
            </li>
		
            <li class="active">自动开标列表</li>
        </ul><!-- .breadcrumb -->

        <div class="nav-search" id="nav-search">
            <form class="form-search">
						<span class="input-icon">
							<input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
							<i class="icon-search nav-search-icon"></i>
						</span>
            </form>
        </div><!-- #nav-search -->
    </div>
	<div class="page-content">
		<div class="page-header">
		    <h1>自动开标列表</h1>
		</div>
		
		#if(${msg})
	     <div>
		     #if(${success})
	    		<li class="text-success">$!{msg}</li>
			 #else
	    		<li class="text-danger">$!{msg}</li>
			 #end    	
		 </div>
	    #end
		
		<div class="container-fluid">
		    <div class="dataTables_wrapper">
		        <div class="row">
		            <div class="col-sm-11">
		                <form class="form-inline" role="form">
		                    <div class="form-group">
		                        <label>标的名称：</label>
		                        <input type="text" name="vcName" value="$!{query.vcName}">
		                    </div>
							<div class="form-group">
		                        <label>期限等级：</label>
		                        <select name="iSubjectPeriodGradeID">
	                        		<option value="">全部</option>
		                            #foreach($!glist in $!subGradeList)
	                        			<option value="$!{glist.id}">$!{glist.vcName}</option>
	                        		#end
		                        </select>
		                    </div>
		                    <div class="form-group">
		                        <label>标的类型：</label>
		                        <select name="itype">
	                        		<option value="">全部</option>
		                            <option value="1" #if($query.itype ==1) selected #end>普通标</option>
		                            <option value="2" #if($query.itype ==2) selected #end>新手标</option>
		                        </select>
		                    </div>
							<div class="form-group">
		                        <label>标的状态：</label>
		                        <select name="istate">
	                        		<option value="00">全部</option>
		                            <option value="5" #if($query.istate ==5) selected #end>审核通过</option>
		                            <option value="11" #if($query.istate ==11) selected #end>投标中</option>
									<option value="12" #if($query.istate ==13) selected #end>还款中</option>
									<option value="14" #if($query.istate ==14) selected #end>已结束</option>
		                        </select>
		                    </div>		
		                    <div class="form-group">
		                        <button class="btn btn-xs btn-primary" type="submit">查询</button>
		                    </div>
		                </form>
		            </div>
		        </div>
		        <table class="table table-striped table-bordered table-hover dataTable">
		            <thead>
		            <tr>
		            	<th>标的名称</th>
		          	    <th>标的类型</th>
		          	    <th>期限等级</th>
						<th>最终审核入库时间</th>
		          	    <th>融资金额</th>
		                <th>预计年利率</th>
		                <th>奖励年利率</th>
		                <th>募集期限（天）</th>
						<th>募集开始时间</th>
						<th>募集结束时间</th>
						<th>借款期限</th>
		                <th>标的状态 </th>
		                <th width="120px" align="center">操作</th>
		            </tr>
		            </thead>
		            <tbody>
		                #foreach($row in $result.rows)
		                <tr>
		                	<td> <a href="$!{www}/subject/getById?id=$!{row.id}">$!{row.vcName} </a></td>
		                	<td>
		                		#if($row.itype && $row.itype ==1) 普通标
	                            #elseif($row.itype && $row.itype ==2) 新手标
								#elseif($row.itype && $row.itype ==3) 普通活动标
								#elseif($row.itype && $row.itype ==4) 新手活动标
								#elseif($row.itype && $row.itype ==5) 秒杀标
								#elseif($row.itype && $row.itype ==6) 爆款标
	                            #end
		                	</td>
		                	<td>$!{row.iSubjectPeriodGradeName}</td>
							<td>$!{row.dtModifyStr}</td>
		                	<td align="right"> $!{row.numTotalFinancing} </td>
		                	<td> $!{row.numInterestRate}% </td>
		                	<td> #if($row.numRewardRate&&$row.numRewardRate !='')  $!{row.numRewardRate}%
		                	#end
		                	</td>
		                	<td>$!{row.iAutoOpenDay} </td>
							<td>$!{row.dtCollectStartStr}</td>
							<td>$!{row.dtCollectEndStr}</td>
							<td>$!{row.numPeriod}</td>
		                	<td> 
		                	#if($row.istate =='1')新录入#end
		                    #if($row.istate =='2')待审核 #end
		                    #if($row.istate =='3')退回 #end
		                    #if($row.istate =='4')作废 #end
		                    #if($row.istate =='5')审核通过#end
		                    #if($row.istate =='6')待预告 #end
		                    #if($row.istate =='10')待开标#end
		                    #if($row.istate =='11')投标中 #end
		                    #if($row.istate =='12')还款中#end
		                    #if($row.istate =='13')结束 #end
		                    #if($row.istate =='14')等待划款 #end
		                	</td>
		                    <td>
		                     #if($row.iAutoOpenPriority != '0')
		                     <script>totalSort+=${row.iAutoOpenPriority}+",";</script>
		                     <a href="javascript:sort('$!{row.id}')">已置顶：$!{row.iAutoOpenPriority}</a> #end
		                   	 #if($row.iAutoOpenPriority =='0' && $row.istate=='5')<a href="javascript:sort('$!{row.id}')">设置置顶</a>#end
								&nbsp;&nbsp;
							#if($row.istate =='5' && !$row.dtCollectStartStr)
								<a href="javascript:xiajia('$!{row.id}')">下架</a>
							#end
		                    </td>
		                </tr>
		                #end
		            </tbody>
		        </table>
		        <div class="row">
		            <div class="col-sm-11">
			        	<div class="red">$!{msg}</div>
			        </div>
			    </div>	
		        <div class="row">
		            <div class="col-sm-12">
		                <div class="dataTables_paginate paging_bootstrap">
		                    <ul class="pagination">
		                        #set($pageRequestURL="$!{www}/subject/autoOpenList?pageIndex=[PAGINATION_PAGE_INDEX]#if($!{result.queryParameters})&$!{result.queryParameters}#end")
		                        #paginationHelper($result $pageRequestURL)
		                    </ul>
		                </div>
		            </div>
		       </div>
		       
		    </div>
		</div>
    </div><!-- /.page-content -->
</div><!-- /.main-content -->
#if($request.getParameter("msg"))
	<script type="text/javascript">
		$(function(){
			alert('$!{request.getParameter("msg")}');
		})
	</script>
#end