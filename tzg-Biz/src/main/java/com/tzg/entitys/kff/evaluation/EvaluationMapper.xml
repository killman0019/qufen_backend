<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tzg.entitys.kff.evaluation.EvaluationMapper">
	<resultMap id="BaseResultMap" type="com.tzg.entitys.kff.evaluation.Evaluation">
		<result property="evaluationId" jdbcType="INTEGER" column="evaluation_id" />
		<result property="projectId" jdbcType="INTEGER" column="project_id" />
		<result property="postId" jdbcType="INTEGER" column="post_id" />
		<result property="postUuid" jdbcType="VARCHAR" column="post_uuid" />
		<result property="modelType" jdbcType="INTEGER" column="model_type" />
		<result property="totalScore" jdbcType="DECIMAL" column="total_score" />
		<result property="professionalEvaDetail" jdbcType="LONGVARCHAR" column="professional_eva_detail" />
		<result property="evauationContent" jdbcType="VARCHAR" column="evauation_content" />
		<result property="evaluationTags" jdbcType="VARCHAR" column="evaluation_tags" />
		<result property="status" jdbcType="INTEGER" column="status" />
		<result property="createTime" jdbcType="TIMESTAMP" column="createTime" />
		<result property="updateTime" jdbcType="TIMESTAMP" column="updateTime" />
		<result property="createUserId" jdbcType="INTEGER" column="create_user_id" />
	</resultMap>

	<sql id="columns">
	    <![CDATA[
        evaluation_id ,project_id ,post_id,post_uuid,model_type ,total_score ,professional_eva_detail ,evauation_content ,evaluation_tags ,status ,createTime ,updateTime ,create_user_id 
	    ]]>
	</sql>

	<insert id="save" parameterType="com.tzg.entitys.kff.evaluation.Evaluation" useGeneratedKeys="true" keyProperty="evaluationId">
		<selectKey resultType="java.lang.Integer" keyProperty="evaluationId" order="AFTER">
			SELECT LAST_INSERT_ID() AS id
		</selectKey>
	<![CDATA[
		INSERT INTO tbevaluation (
        	project_id ,
        	post_id,
        	post_uuid,
        	model_type ,
        	total_score ,
        	professional_eva_detail ,
        	evauation_content ,
        	evaluation_tags ,
        	status ,
        	createTime ,
        	updateTime ,
        	create_user_id 
		) VALUES (
        	#{projectId,jdbcType=INTEGER} ,
        	#{postId,jdbcType=INTEGER} ,
        	#{postUuid,jdbcType=VARCHAR} ,
        	#{modelType,jdbcType=INTEGER} ,
        	#{totalScore,jdbcType=DECIMAL} ,
        	#{professionalEvaDetail,jdbcType=LONGVARCHAR} ,
        	#{evauationContent,jdbcType=VARCHAR} ,
        	#{evaluationTags,jdbcType=VARCHAR} ,
        	#{status,jdbcType=INTEGER} ,
        	#{createTime,jdbcType=TIMESTAMP} ,
        	#{updateTime,jdbcType=TIMESTAMP} ,
        	#{createUserId,jdbcType=INTEGER} 
		)
	]]>
	</insert>

	<update id="update" parameterType="com.tzg.entitys.kff.evaluation.Evaluation">
		UPDATE tbevaluation
		<set>
			<if test="projectId != null">
				project_id = #{projectId,jdbcType=INTEGER} ,
			</if>
			<if test="modelType != null">
				model_type = #{modelType,jdbcType=BIT} ,
			</if>
			<if test="totalScore != null">
				total_score = #{totalScore,jdbcType=DECIMAL} ,
			</if>
			<if test="professionalEvaDetail != null">
				professional_eva_detail = #{professionalEvaDetail,jdbcType=LONGVARCHAR} ,
			</if>
			<if test="evauationContent != null">
				evauation_content = #{evauationContent,jdbcType=VARCHAR} ,
			</if>
			<if test="evaluationTags != null">
				evaluation_tags = #{evaluationTags,jdbcType=VARCHAR} ,
			</if>
			<if test="status != null">
				status = #{status,jdbcType=INTEGER} ,
			</if>
			<if test="createTime != null">
				createTime = #{createTime,jdbcType=TIMESTAMP} ,
			</if>
			<if test="updateTime != null">
				updateTime = #{updateTime,jdbcType=TIMESTAMP} ,
			</if>
			<if test="createUserId != null">
				create_user_id = #{createUserId,jdbcType=INTEGER}
			</if>
		</set>
		WHERE
		evaluation_id = #{evaluationId,jdbcType=INTEGER}
	</update>

	<delete id="deleteById" parameterType="java.lang.Integer">
	<![CDATA[
		DELETE FROM tbevaluation WHERE
        evaluation_id = #{evaluationId} 
	]]>
	</delete>

	<select id="findById" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		SELECT
		<include refid="columns" /> 
	<![CDATA[
		FROM tbevaluation 
		WHERE 
        evaluation_id = #{evaluationId} 
	]]>
	</select>

	<select id="findPageCount" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from tbevaluation where 1=1
		<include refid="queryWhere" />
	</select>

	<select id="findPage" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		<include refid="columns" />
		from tbevaluation where 1=1
		<include refid="queryWhere" /> 
	    <![CDATA[ ORDER BY evaluation_id DESC ]]>
        <![CDATA[ LIMIT ${startRecord},${endRecord} ]]>
	</select>

	<sql id="queryWhere">
		<if test="evaluationId != null and evaluationId.trim() != ''">
			and evaluation_id = #{evaluationId}
		</if>
		<if test="projectId != null and projectId.trim() != ''">
			and project_id = #{projectId}
		</if>
		<if test="postId != null and postId.trim() != ''">
			and post_id = #{postId}
		</if>
		<if test="postUuid != null and postUuid.trim() != ''">
			and post_uuid = #{postUuid}
		</if>
		<if test="modelType != null and modelType.trim() != ''">
			and model_type = #{modelType}
		</if>
		<if test="totalScore != null and totalScore.trim() != ''">
			and total_score = #{totalScore}
		</if>
		<if test="professionalEvaDetail != null and professionalEvaDetail.trim() != ''">
			and professional_eva_detail = #{professionalEvaDetail}
		</if>
		<if test="evauationContent != null and evauationContent.trim() != ''">
			and evauation_content = #{evauationContent}
		</if>
		<if test="evaluationTags != null and evaluationTags.trim() != ''">
			and evaluation_tags = #{evaluationTags}
		</if>
		<if test="status != null and status.trim() != ''">
			and status = #{status}
		</if>
		<if test="createTimeBegin != null and createTimeBegin.trim() != ''">
			and createTime >= #{createTimeBegin}
		</if>
		<if test="createTimeEnd != null and createTimeEnd.trim() != ''">
			and createTime &lt;= #{createTimeEnd}
		</if>
		<if test="updateTimeBegin != null and updateTimeBegin.trim() != ''">
			and updateTime >= #{updateTimeBegin}
		</if>
		<if test="updateTimeEnd != null and updateTimeEnd.trim() != ''">
			and updateTime &lt;= #{updateTimeEnd}
		</if>
		<if test="createUserId != null and createUserId.trim() != ''">
			and create_user_id = #{createUserId}
		</if>
	</sql>
	<select id="selectEvaluationByPostId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		SELECT
		<include refid="columns" /> 
		FROM tbevaluation 
		WHERE 
       post_id = #{postId} and status=1
	</select>
	
	<select id="findEvaliationByProjectId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		SELECT
		<include refid="columns" /> 
		FROM tbevaluation 
		WHERE 
      project_id = #{projectId} and status=1
	</select>
	
	<select id="selectEvaluationOrNotByUserId" resultMap="BaseResultMap" >
		SELECT
		<include refid="columns" /> 
		FROM tbevaluation 
		WHERE 
     create_user_id = #{createUserId} and status=1  and model_type = #{modelType} and project_id = #{projectId}
	</select>
</mapper>


