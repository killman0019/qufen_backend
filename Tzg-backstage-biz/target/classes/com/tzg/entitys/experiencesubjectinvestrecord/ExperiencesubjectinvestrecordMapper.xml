<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tzg.entitys.experiencesubjectinvestrecord.ExperiencesubjectinvestrecordMapper">	
	<resultMap id="BaseResultMap" type="com.tzg.entitys.experiencesubjectinvestrecord.Experiencesubjectinvestrecord">
		<result property="id" jdbcType="INTEGER" column="id"/>
		<result property="iloginAccountId" jdbcType="INTEGER" column="iLoginAccountID"/>
		<result property="isubjectId" jdbcType="INTEGER" column="iSubjectID"/>
		<result property="vcName" jdbcType="VARCHAR" column="vcName"/>
		<result property="numInterestRate" jdbcType="DECIMAL" column="numInterestRate"/>
		<result property="numRewardRate" jdbcType="DECIMAL" column="numRewardRate"/>
		<result property="dtInvest" jdbcType="TIMESTAMP" column="dtInvest"/>
		<result property="numInvest" jdbcType="DECIMAL" column="numInvest"/>
		<result property="numActualExtraInterest" jdbcType="DECIMAL" column="numActualExtraInterest"/>
		<result property="numActualInterest" jdbcType="DECIMAL" column="numActualInterest"/>
		<result property="dtRepay" jdbcType="DATE" column="dtRepay"/>
		<result property="istate" jdbcType="INTEGER" column="iState"/>
		<result property="dtCreate" jdbcType="TIMESTAMP" column="dtCreate"/>
		<result property="vcInvestDevice" jdbcType="VARCHAR" column="vcInvestDevice"/>
		<result property="irepayMode" jdbcType="INTEGER" column="iRepayMode"/>
		<result property="dtCollectEnd" jdbcType="TIMESTAMP" column="dtCollectEnd"/>
		<result property="vcContractNo" jdbcType="VARCHAR" column="vcContractNo"/>
    </resultMap>
	
	<sql id="columns">
	    <![CDATA[
        id ,iLoginAccountID ,iSubjectID ,vcName ,numInterestRate ,numRewardRate ,dtInvest ,numInvest ,numActualExtraInterest ,numActualInterest ,dtRepay ,iState ,dtCreate ,vcInvestDevice ,iRepayMode ,dtCollectEnd ,vcContractNo 
	    ]]>
	</sql>
	
	<insert id="save" parameterType="com.tzg.entitys.experiencesubjectinvestrecord.Experiencesubjectinvestrecord" useGeneratedKeys="true" keyProperty="id">
		<selectKey resultType="java.lang.Integer" keyProperty="id" order="AFTER" >
	      SELECT LAST_INSERT_ID() AS id
	    </selectKey>
	<![CDATA[
		INSERT INTO tbexperiencesubjectinvestrecord (
        	iLoginAccountID ,
        	iSubjectID ,
        	vcName ,
        	numInterestRate ,
        	numRewardRate ,
        	dtInvest ,
        	numInvest ,
        	numActualExtraInterest ,
        	numActualInterest ,
        	dtRepay ,
        	iState ,
        	dtCreate ,
        	vcInvestDevice ,
        	iRepayMode ,
        	dtCollectEnd ,
        	vcContractNo 
		) VALUES (
        	#{iloginAccountId,jdbcType=INTEGER} ,
        	#{isubjectId,jdbcType=INTEGER} ,
        	#{vcName,jdbcType=VARCHAR} ,
        	#{numInterestRate,jdbcType=DECIMAL} ,
        	#{numRewardRate,jdbcType=DECIMAL} ,
        	#{dtInvest,jdbcType=TIMESTAMP} ,
        	#{numInvest,jdbcType=DECIMAL} ,
        	#{numActualExtraInterest,jdbcType=DECIMAL} ,
        	#{numActualInterest,jdbcType=DECIMAL} ,
        	#{dtRepay,jdbcType=DATE} ,
        	#{istate,jdbcType=INTEGER} ,
        	#{dtCreate,jdbcType=TIMESTAMP} ,
        	#{vcInvestDevice,jdbcType=VARCHAR} ,
        	#{irepayMode,jdbcType=INTEGER} ,
        	#{dtCollectEnd,jdbcType=TIMESTAMP} ,
        	#{vcContractNo,jdbcType=VARCHAR} 
		)
	]]>
	</insert>

	<update id="update" parameterType="com.tzg.entitys.experiencesubjectinvestrecord.Experiencesubjectinvestrecord">
		UPDATE tbexperiencesubjectinvestrecord
		<set>
			<if test="iloginAccountId != null">
	        iLoginAccountID = #{iloginAccountId,jdbcType=INTEGER} ,
	        </if>
			<if test="isubjectId != null">
	        iSubjectID = #{isubjectId,jdbcType=INTEGER} ,
	        </if>
			<if test="vcName != null">
	        vcName = #{vcName,jdbcType=VARCHAR} ,
	        </if>
			<if test="numInterestRate != null">
	        numInterestRate = #{numInterestRate,jdbcType=DECIMAL} ,
	        </if>
			<if test="numRewardRate != null">
	        numRewardRate = #{numRewardRate,jdbcType=DECIMAL} ,
	        </if>
			<if test="dtInvest != null">
	        dtInvest = #{dtInvest,jdbcType=TIMESTAMP} ,
	        </if>
			<if test="numInvest != null">
	        numInvest = #{numInvest,jdbcType=DECIMAL} ,
	        </if>
			<if test="numActualExtraInterest != null">
	        numActualExtraInterest = #{numActualExtraInterest,jdbcType=DECIMAL} ,
	        </if>
			<if test="numActualInterest != null">
	        numActualInterest = #{numActualInterest,jdbcType=DECIMAL} ,
	        </if>
			<if test="dtRepay != null">
	        dtRepay = #{dtRepay,jdbcType=DATE} ,
	        </if>
			<if test="istate != null">
	        iState = #{istate,jdbcType=INTEGER} ,
	        </if>
			<if test="dtCreate != null">
	        dtCreate = #{dtCreate,jdbcType=TIMESTAMP} ,
	        </if>
			<if test="vcInvestDevice != null">
	        vcInvestDevice = #{vcInvestDevice,jdbcType=VARCHAR} ,
	        </if>
			<if test="irepayMode != null">
	        iRepayMode = #{irepayMode,jdbcType=INTEGER} ,
	        </if>
			<if test="dtCollectEnd != null">
	        dtCollectEnd = #{dtCollectEnd,jdbcType=TIMESTAMP} ,
	        </if>
			<if test="vcContractNo != null">
	        vcContractNo = #{vcContractNo,jdbcType=VARCHAR} 
	        </if>
	    </set>
		WHERE 
	        id = #{id,jdbcType=INTEGER} 
	</update>

	<delete id="deleteById" parameterType="java.lang.Integer">
	<![CDATA[
		DELETE FROM tbexperiencesubjectinvestrecord WHERE
        id = #{id} 
	]]>
	</delete>
    
	<select id="findById" resultMap="BaseResultMap" parameterType="java.lang.Integer">
	    SELECT <include refid="columns"/> 
	<![CDATA[
		FROM tbexperiencesubjectinvestrecord 
		WHERE 
        id = #{id} 
	]]>
	</select>
	 
	<select id="findPageCount" resultType="java.lang.Integer" parameterType="java.util.Map">
    	select count(*) from tbexperiencesubjectinvestrecord where 1=1
		<include refid="queryWhere"/>
	</select>
    
	<select id="findPage" resultMap="BaseResultMap" parameterType="java.util.Map">
		select <include refid="columns"/>  from tbexperiencesubjectinvestrecord where 1=1
		<include refid="queryWhere"/> 
   		<choose>
            <when test="sortField != null and sortField != ''">
               ORDER BY ${sortField} desc
            </when>
            <otherwise>
                 ORDER BY id DESC 
            </otherwise>
        </choose>
        <![CDATA[ LIMIT ${startRecord},${endRecord} ]]>
	</select>
	
	<sql id="queryWhere">
		<if test="id != null and id.trim() != ''">
		and id = #{id}
		</if>
		<if test="iloginAccountId != null and iloginAccountId.trim() != ''">
		and iLoginAccountID = #{iloginAccountId}
		</if>
		<if test="isubjectId != null and isubjectId.trim() != ''">
		and iSubjectID = #{isubjectId}
		</if>
		<if test="vcName != null and vcName.trim() != ''">
		and vcName = #{vcName}
		</if>
		<if test="numInterestRate != null and numInterestRate.trim() != ''">
		and numInterestRate = #{numInterestRate}
		</if>
		<if test="numRewardRate != null and numRewardRate.trim() != ''">
		and numRewardRate = #{numRewardRate}
		</if>
		<if test="dtInvestBegin != null and dtInvestBegin.trim() != ''">
		and dtInvest >= #{dtInvestBegin}
		</if>
		<if test="dtInvestEnd != null and dtInvestEnd.trim() != ''">
		and dtInvest &lt;= #{dtInvestEnd}
		</if>
		<if test="numInvest != null and numInvest.trim() != ''">
		and numInvest = #{numInvest}
		</if>
		<if test="numActualExtraInterest != null and numActualExtraInterest.trim() != ''">
		and numActualExtraInterest = #{numActualExtraInterest}
		</if>
		<if test="numActualInterest != null and numActualInterest.trim() != ''">
		and numActualInterest = #{numActualInterest}
		</if>
		<if test="dtRepayBegin != null and dtRepayBegin.trim() != ''">
		and dtRepay >= #{dtRepayBegin}
		</if>
		<if test="dtRepayEnd != null and dtRepayEnd.trim() != ''">
		and dtRepay &lt;= #{dtRepayEnd}
		</if>
		<if test="istate != null and istate.trim() != ''">
		and iState = #{istate}
		</if>
		<if test="andIstateIn != null and andIstateIn.trim() != ''">
		and iState in (${andIstateIn})
		</if>
		<if test="dtCreateBegin != null and dtCreateBegin.trim() != ''">
		and dtCreate >= #{dtCreateBegin}
		</if>
		<if test="dtCreateEnd != null and dtCreateEnd.trim() != ''">
		and dtCreate &lt;= #{dtCreateEnd}
		</if>
		<if test="vcInvestDevice != null and vcInvestDevice.trim() != ''">
		and vcInvestDevice = #{vcInvestDevice}
		</if>
		<if test="irepayMode != null and irepayMode.trim() != ''">
		and iRepayMode = #{irepayMode}
		</if>
		<if test="dtCollectEndBegin != null and dtCollectEndBegin.trim() != ''">
		and dtCollectEnd >= #{dtCollectEndBegin}
		</if>
		<if test="dtCollectEndEnd != null and dtCollectEndEnd.trim() != ''">
		and dtCollectEnd &lt;= #{dtCollectEndEnd}
		</if>
		<if test="vcContractNo != null and vcContractNo.trim() != ''">
		and vcContractNo = #{vcContractNo}
		</if>
	</sql>
	
	<select id="countInvestRecord" parameterType="java.util.Map" resultType="java.lang.Integer" >
		SELECT
			count(1)
		FROM
			tbexperiencesubjectinvestrecord ir
		WHERE
			ir.iLoginAccountID = #{iLoginAccountID,jdbcType=INTEGER}
			<if test="isubjectId != null ">
			and ir.iSubjectID = #{isubjectId,jdbcType=INTEGER}
			</if>
	</select>
	
	<update id="updateStateBySubjectId" parameterType="java.util.Map">
		UPDATE tbexperiencesubjectinvestrecord
	    set iState = #{istate,jdbcType=INTEGER} 
		WHERE  iSubjectID = #{isubjectid,jdbcType=INTEGER} 
	</update>
	
	<select id="statProfit" parameterType="java.util.Map" resultType="java.math.BigDecimal">
		SELECT
			sum(ir.numActualInterest)
		FROM
			tbexperiencesubjectinvestrecord ir
		WHERE
			ir.iSubjectID = #{isubjectid,jdbcType=INTEGER} 
	</select>
</mapper>


