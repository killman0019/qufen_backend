<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tzg.entitys.leopard.console.ConsoleLoginAccountMapper">
    <resultMap id="ConsoleAccount" type="com.tzg.entitys.leopard.console.ConsoleLoginAccount">
        <id column="id" jdbcType="INTEGER" property="id" />
        <result column="vcLoginName" jdbcType="VARCHAR" property="vcLoginName" />
        <result column="vcLoginPassword" jdbcType="VARCHAR" property="vcLoginPassword" />
        <result column="vcRealName" jdbcType="VARCHAR" property="vcRealName" />
        <result property="vcPhone" jdbcType="CHAR" column="vcPhone"/>
        <result column="iValid" jdbcType="INTEGER" property="iValid" />
        <result column="dtCreate" jdbcType="TIMESTAMP" property="dtCreate" />
        <result column="dtModify" jdbcType="TIMESTAMP" property="dtModify" />
    </resultMap>

    <insert id="save" parameterType="com.tzg.entitys.leopard.console.ConsoleLoginAccount"
            useGeneratedKeys="true" keyProperty="id">
        <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="id">
            SELECT LAST_INSERT_ID() AS id
        </selectKey>
        insert into 
        tbconsoleloginaccount(
        	vcLoginName,vcLoginPassword,vcRealName ,vcPhone,iValid,dtCreate
        )
        values (
	        #{vcLoginName,jdbcType=VARCHAR},
	        #{vcLoginPassword,jdbcType=VARCHAR},
	        #{vcRealName,jdbcType=VARCHAR},
	        #{vcPhone,jdbcType=CHAR} ,
	        #{iValid,jdbcType=INTEGER},
	        #{dtCreate,jdbcType=TIMESTAMP}
        )
    </insert>

    <select id="queryAccountsCount" parameterType="java.util.Map" resultType="java.lang.Integer">
        SELECT count(*) from  tbconsoleloginaccount where 1=1
        <if test="vcLoginName != null">
           and  vcLoginName like "%"#{vcLoginName}"%"
        </if>
        <if test="iValid != null">
           and  iValid  = #{iValid,jdbcType=INTEGER}
        </if>        
    </select>

    <select id="queryAccounts" parameterType="java.util.Map" resultMap="ConsoleAccount">
        SELECT * from  tbconsoleloginaccount where 1=1
        <if test="vcLoginName != null">
            and  vcLoginName like "%"#{vcLoginName}"%"
        </if>
        <if test="iValid != null">
           and  iValid  = #{iValid,jdbcType=INTEGER}
        </if>           
        ORDER BY id DESC
        <![CDATA[ limit ${startRecord},${endRecord} ]]>
    </select>

    <select id="selectByName" parameterType="java.lang.String" resultMap="ConsoleAccount">
        SELECT * from  tbconsoleloginaccount a where vcLoginName = #{loginName,jdbcType=VARCHAR}
    </select>

    <select id="findById" parameterType="java.lang.Integer" resultMap="ConsoleAccount">
        SELECT * from  tbconsoleloginaccount a where id = #{id,jdbcType=INTEGER}
    </select>

    <update id="update" parameterType="com.tzg.entitys.leopard.console.ConsoleLoginAccount">
          update  tbconsoleloginaccount set 
		          vcLoginName = #{vcLoginName,jdbcType=VARCHAR},
		          vcRealName = #{vcRealName,jdbcType=VARCHAR},
		          vcPhone = #{vcPhone,jdbcType=CHAR} ,
		          iValid = #{iValid,jdbcType=INTEGER},
		          dtModify = #{dtModify,jdbcType=TIMESTAMP} 
          where id = #{id,jdbcType=INTEGER};
    </update>

    <update id="updatePassword" parameterType="com.tzg.entitys.leopard.console.ConsoleLoginAccount">
        update tbconsoleloginaccount set 
        	vcLoginPassword = #{vcLoginPassword,jdbcType=VARCHAR},
        	dtModify = #{dtModify,jdbcType=TIMESTAMP} 
        where id = #{id,jdbcType=INTEGER};
    </update>

    <delete id="delete" parameterType="java.lang.Integer">
           delete from tbconsoleloginaccount where id = #{id,jdbcType=INTEGER}
    </delete>
    
    <!-- 查询当前用户的审核权限 -->
    <select id="queryCurrentUserAudit" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    	select DISTINCT c.iApprovalRatingID from tbroleinfo c where c.id in
		(select b.iRoleinfoID from tbpersonalrole b where b.iConsoleLoginAccountID = #{id,jdbcType=INTEGER}) 
    </select>
    
    <select id="queryConsoleLoginAccountAll" resultMap="ConsoleAccount">
    	select * from tbconsoleloginaccount
    	where iValid = 1
    </select>
    
    
</mapper>