<div class="main-content">
    <div class="breadcrumbs" id="breadcrumbs">
        

        <ul class="breadcrumb">
            <li>
                <i class="icon-home home-icon"></i>
                <a href="${www}/main">主页</a>
            </li>

            <li>
                <a href="${www}/interestticketapply/grantlist">加息券发放列表</a>
            </li>
            <li class="active">定向加息券发放</li>
        </ul><!-- .breadcrumb -->

        <div class="nav-search" id="nav-search">
            <form class="form-search">
						<span class="input-icon">
							<input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
							<i class="icon-search nav-search-icon"></i>
						</span>
            </form>
        </div><!-- #nav-search -->
    </div>

    <div class="page-content">
        <div class="page-header">
            <h1>定向加息券发放</h1>
        </div>
        <form action="${www}/interestticketapply/grant" method="post" class="form-horizontal" id="inputForm_subject" enctype="multipart/form-data"  >
           <input type="hidden" id="interestticketapplyid" name="interestticketapplyid" value="${param.id}" />
            <div class="row">
                <div class="col-xs-12 col-md-6">
                    <div class="form-group">
                        <label class="col-md-4 col-sm-2 control-label">活动名称：</label>
                        <div class="col-md-8 col-sm-4">
                                ${param.vcInterestTicketAccountName}
                                 <div class="col-sm-1" style="float:right;">
           			 				<a href="$!{www}/interestticketapply/directedredDown?name=${param.vcInterestTicketAccountName}&id=${param.id}" class="btn btn-success btn-xs">人工定向发放下载</a>
         	 					</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 col-sm-2 control-label">加息券：</label>
                        <div class="col-md-8 col-sm-8">
                              <select style="width:100px;" name="respondid" id="respondid">
								<option value="">--请选择--</option>
	                    	    #foreach($row in $respondList)
									#set ($ticketCount= $row.itotalCount - $row.ireceivedCount )
	                    	    	<option    #if($!{row.id}==$!{respondid}) selected="selected" #end itotalCount="$!{row.itotalCount}" ireceivedCount="$!{row.ireceivedCount}"   value="$!{row.id}" data-count="$!{ticketCount}">$!{row.numInterestRate} </option>  
								#end
	                    	</select>&nbsp;%加息券
	                    	<input type="text" style="width:70px;" id="purchase"  name="purchase" value="$!{purchase}" /> 张(剩余<span id="ticketCount">0</span>张)
                        </div>
                    </div>
                   
                    <div class="form-group">
                        <label class="col-md-4 col-sm-2 control-label">手机号码：</label>
                        <div class="col-md-8 col-sm-4">
                            <input type="text" class="col-sm-6" name="vcPhone" id="vcPhone" value="$!{param.vcPhone}"/>
                        </div>
                       
                    </div>
                     <div class="form-group">
                        <label class="col-md-4 col-sm-2 control-label">批量上传：</label>
                       <div class="col-md-8 col-sm-4">
           			 		<input type="file" class="col-sm-12" id="uploadfile" name="uploadfile"  /> 
         	 			</div>
                    </div>
               	</div>
            </div>
        #if(${msg})
	     <div>
		     #if(${success})
	    		<li class="text-success">$!{msg}</li>
			 #else
	    		<li class="text-danger">$!{msg}</li>
			 #end    	
		 </div>
	    #end
            <div class="clearfix form-actions">
                <div class="col-sm-offset-2 col-md-9">
                     <button class="btn btn-info" type="button" onclick="javascript:history.go(-1);">
		                <i class="icon-arrow-left bigger-110"></i>返回
		            </button>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		           <button class="btn btn-info" type="button" onclick="checkSubmit();">
                        <i class="icon-ok bigger-110"></i> 确认发放
                    </button>
                </div>
            </div>
</form>
    </div><!-- /.page-content -->
</div><!-- /.main-content -->
#if($request.getParameter("msg"))
	<script type="text/javascript">
		$(function(){
			alert('$!{request.getParameter("msg")}');
		})
	</script>
#end

<script type="text/javascript">
    try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
    (function(){
		var vcPhone = document.getElementById("vcPhone");
		var respondid= document.getElementById("respondid");
		var purchase= document.getElementById("purchase");
		var inputForm_subject = document.getElementById("inputForm_subject");
		
    })();
    
    function checkSubmit(){
		if(vcPhone.value==""){
			if($("#uploadfile")==""){
				alert("手机号不能为空");
				vcPhone.focus();
				return false;
			}
		}else{
			if(!(/^((13[0-9])|(14[0-9])|(15[^4,\D])|(17[0-9])|(18[0-9]))\d{8}$/.test(vcPhone.value))){
				alert("手机号格式不正确");
				vcPhone.focus();
				return false;
			}
		}
		if(respondid.value==""){
			alert("请选择需要发放的加息券");
			return false;
		}
		var a=/^[0-9]*$/;
		if(purchase.value==""){
			alert("加息券张数不能为空");
			return false;
		}else{
			if(!a.test(purchase.value)){
				alert("加息券张数请输入数字");
				return false;
			}
		}
		inputForm_subject.submit();
	}
</script>

<script>
$(function(){
	$("#respondid").change(function(){
		var selectedIndex = this.selectedIndex;
		var currentOption = this.options[selectedIndex];
		var count= parseFloat(currentOption.getAttribute('itotalCount')) - parseFloat(currentOption.getAttribute('ireceivedCount'));
		$('#ticketCount').html(count);
	});	

})
</script>

